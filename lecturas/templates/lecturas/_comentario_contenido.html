{% load auth_extras %}
{% load static %}

<div class="comment-header">
    <div class="comment-avatar">
        <img src="{% if comentario.autor.profile.avatar %}{{ comentario.autor.profile.avatar.url }}{% else %}{% static 'profiles/default.png' %}{% endif %}" 
             alt="Avatar de {{ comentario.autor.username }}"
             class="user-avatar-small"
             onerror="this.src='{% static 'profiles/default.png' %}'">
    </div>
    <div class="comment-user-info">
        <strong class="username">{{ comentario.autor.username }}</strong> 
        <small class="comment-date" title="{{ comentario.fecha_creacion|date:"d M Y, H:i" }}">
            <i class="far fa-clock"></i>
            hace {{ comentario.fecha_creacion|timesince }}
        </small>
    </div>
</div>

<div class="respuesta-contenido respuesta-contenido-compacto">
    {{ comentario.contenido|safe }}
</div>

<!-- IMÃGENES VISUALIZADAS DIRECTAMENTE - SIN ENLACE -->
{% if comentario.imagen_comentario %}
    <div class="comentario-imagen" style="margin-top: 0.75rem;">
        <img src="{{ comentario.imagen_comentario.url }}" 
             alt="Imagen en comentario de {{ comentario.autor.username }}"
             title="Imagen adjunta por {{ comentario.autor.username }}"
             style="max-width: min(300px, 100%); height: auto; border-radius: 8px; border: 1px solid var(--border-color);">
    </div>
{% endif %}

<!-- ARCHIVOS COMO ENLACES (solo los archivos, no las imÃ¡genes) -->
{% if comentario.adjunto_comentario %}
    <div class="comentario-adjunto" style="margin-top: 0.5rem;">
        <a href="{{ comentario.adjunto_comentario.url }}" target="_blank" class="btn-adjunto">
            ðŸ“Ž {{ comentario.adjunto_comentario.name|slice:"-20:" }}
        </a>
    </div>
{% endif %}

{% if user == comentario.autor or user.is_superuser or user|has_group:"Administrativo" %}
    <div class="respuesta-acciones-compactas">
        <a href="#" class="reply-btn" data-id="{{ comentario.pk }}">Responder</a>
        <a href="#" class="edit-comment-btn" data-url="{% url 'lecturas:editar_comentario_ajax' pk=comentario.pk %}">Editar</a>
        <a href="#" class="delete-comment-btn" data-url="{% url 'lecturas:borrar_comentario_ajax' pk=comentario.pk %}">Borrar</a>
    </div>
{% endif %}
<form method="post" action="{% url 'lecturas:editar_comentario_ajax' pk=comentario.pk %}" class="ajax-edit-form" enctype="multipart/form-data">
    {% csrf_token %}
    
    <div class="form-group">
        {{ form.contenido }}
    </div>
    
    <!-- Archivos actuales con estilo mejorado -->
    {% if comentario.adjunto_comentario or comentario.imagen_comentario %}
        <div class="current-files-section">
            <h5 style="margin-bottom: 0.75rem; font-size: 0.9rem; opacity: 0.8;">
                <i class="fas fa-folder-open"></i> Archivos Actuales
            </h5>
            
            {% if comentario.adjunto_comentario %}
                <div class="current-file-item">
                    <div class="file-info">
                        <i class="fas fa-paperclip"></i>
                        <a href="{{ comentario.adjunto_comentario.url }}" target="_blank">
                            {{ comentario.adjunto_comentario.name|slice:"-40:" }}
                        </a>
                    </div>
                    <label class="clear-file-option">
                        <input type="checkbox" name="adjunto_comentario-clear" id="adjunto_comentario-clear_id">
                        <span><i class="fas fa-trash-alt"></i> Eliminar</span>
                    </label>
                </div>
            {% endif %}
            
            {% if comentario.imagen_comentario %}
                <div class="current-file-item">
                    <div class="file-info">
                        <i class="fas fa-image"></i>
                        <a href="{{ comentario.imagen_comentario.url }}" target="_blank">Ver imagen actual</a>
                    </div>
                    <label class="clear-file-option">
                        <input type="checkbox" name="imagen_comentario-clear" id="imagen_comentario-clear_id">
                        <span><i class="fas fa-trash-alt"></i> Eliminar</span>
                    </label>
                </div>
                
                <!-- Preview de la imagen -->
                <div style="margin-top: 0.5rem;">
                    <img src="{{ comentario.imagen_comentario.url }}" 
                         alt="Imagen actual" 
                         style="max-width: 200px; height: auto; border-radius: 6px; border: 1px solid var(--border-color);">
                </div>
            {% endif %}
        </div>
    {% endif %}
    
    <hr style="margin: 1.25rem 0; opacity: 0.3;">
    
    <!-- Sección de nuevos archivos -->
    <div class="new-files-section">
        <h5 style="margin-bottom: 0.75rem; font-size: 0.9rem; opacity: 0.8;">
            <i class="fas fa-upload"></i> Subir Nuevos Archivos
        </h5>
        
        <div class="custom-file-wrapper" data-field-id="id_adjunto_comentario">
            <input type="file" 
                   name="adjunto_comentario" 
                   id="id_adjunto_comentario" 
                   accept=".pdf,.doc,.docx,.epub">
            <button type="button" class="custom-file-trigger">
                <i class="fas fa-paperclip"></i>
                <span>Seleccionar Archivo</span>
            </button>
            <div class="file-preview-container"></div>
            <small style="display: block; margin-top: 0.5rem; opacity: 0.7; font-size: 0.85rem;">
                Formatos: PDF, DOC, DOCX, EPUB (máx. 8MB)
            </small>
        </div>
        
        <div class="custom-file-wrapper" data-field-id="id_imagen_comentario" style="margin-top: 0.75rem;">
            <input type="file" 
                   name="imagen_comentario" 
                   id="id_imagen_comentario" 
                   accept=".jpg,.jpeg,.png,.webp">
            <button type="button" class="custom-file-trigger">
                <i class="fas fa-image"></i>
                <span>Seleccionar Imagen</span>
            </button>
            <div class="file-preview-container"></div>
            <small style="display: block; margin-top: 0.5rem; opacity: 0.7; font-size: 0.85rem;">
                Formatos: JPG, JPEG, PNG, WEBP (máx. 3MB)
            </small>
        </div>
    </div>
    
    <!-- Contenedor de acciones -->
    <div class="acciones-comentario" style="margin-top: 1.5rem;">
        <div></div> <!-- Spacer -->
        <div>
            <button type="submit" class="btn-envio-compacto">
                <i class="fas fa-save"></i> Guardar Cambios
            </button>
            <button type="button" class="cancel-edit-btn btn-adjunto">
                <i class="fas fa-times"></i> Cancelar
            </button>
        </div>
    </div>

    <!-- Manejo de errores -->
    {% if form.errors %}
        <div class="error-box" style="margin-top: 1rem;">
            <p><strong>Por favor, corrige los siguientes errores:</strong></p>
            {{ form.errors }}
        </div>
    {% endif %}
</form>
{% load static %}
<div class="editor-block block-type-imagen glass-card"
    data-id="{{ bloque.pk }}"
    data-tipo="imagen"
    data-manage-url="{% url 'comunicaciones:gestionar_bloque_ajax' bloque_pk=bloque.pk %}">
    
    <div class="block-controls">
        <span class="drag-handle" title="Arrastrar para reordenar"><i class="fas fa-grip-vertical"></i></span>
        <button type="button" class="delete-block-btn btn-icon danger" title="Borrar bloque"><i class="fas fa-trash"></i></button>
    </div>

    <div class="block-content">
        <!-- Contenedor principal para el layout de dos columnas -->
        <div class="image-block-layout">
            
            <!-- Columna 1: Subida y Previsualización de Imagen -->
            <div class="image-upload-area">
                <label>Imagen</label>
                <div class="file-preview-container">
                    {% if bloque.contenido_imagen %}
                        <img src="{{ bloque.contenido_imagen.url }}" alt="Imagen actual del bloque" class="image-preview">
                    {% else %}
                        <div class="image-placeholder">
                            <i class="fas fa-image"></i>
                            <span>Sube una imagen</span>
                        </div>
                    {% endif %}
                </div>
                <!-- El input de archivo real, oculto -->
                <input type="file" name="file" class="block-file-input" accept="image/*" style="display: none;">
                <!-- Botón que activa el input de archivo -->
                <button type="button" class="custom-file-trigger">
                    <i class="fas fa-camera"></i> 
                    <span>{% if bloque.contenido_imagen %}Cambiar Imagen{% else %}Seleccionar Imagen{% endif %}</span>
                </button>
            </div>

            <!-- Columna 2: Controles de la Imagen -->
            <div class="image-controls-container">
                {% if bloque.contenido_imagen %}
                    {% include 'comunicaciones/bloques/_imagen_controls.html' with bloque=bloque %}
                {% else %}
                    <div class="controls-placeholder">
                        <i class="fas fa-sliders-h"></i>
                        <p>Los controles de tamaño y alineación aparecerán aquí después de subir una imagen.</p>
                    </div>
                {% endif %}
            </div>

        </div>
    </div>
</div>
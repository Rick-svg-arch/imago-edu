<script>
    document.addEventListener('DOMContentLoaded', function() {
        const enterButton = document.getElementById('btn-enter-focus');
        const exitButton = document.getElementById('btn-exit-focus');
        const lecturaContainer = document.getElementById('lectura-container');
        const body = document.body;

        // Verificamos si la API de Pantalla Completa es compatible
        const isFullscreenEnabled = document.fullscreenEnabled || document.webkitFullscreenEnabled || document.mozFullScreenEnabled || document.msFullscreenEnabled;

        if (!enterButton || !exitButton || !lecturaContainer || !isFullscreenEnabled) {
            if (enterButton) enterButton.style.display = 'none'; // Oculta el botón si no es compatible
            console.error("Modo Concentración no es compatible o faltan elementos.");
            return;
        }

        function enterFocusMode() {
            body.classList.add('focus-mode');
            
            // Petición para entrar en pantalla completa
            if (lecturaContainer.requestFullscreen) {
                lecturaContainer.requestFullscreen();
            } else if (lecturaContainer.webkitRequestFullscreen) { /* Safari */
                lecturaContainer.webkitRequestFullscreen();
            } else if (lecturaContainer.msRequestFullscreen) { /* IE11 */
                lecturaContainer.msRequestFullscreen();
            }
        }

        function exitFocusMode() {
            body.classList.remove('focus-mode');

            // Petición para salir de pantalla completa
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) { /* Safari */
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) { /* IE11 */
                document.msExitFullscreen();
            }
        }

        // --- Event Listeners ---
        enterButton.addEventListener('click', enterFocusMode);
        exitButton.addEventListener('click', exitFocusMode);

        // Listener para detectar cuando se sale de pantalla completa (ej. con la tecla ESC)
        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('mozfullscreenchange', handleFullscreenChange);
        document.addEventListener('MSFullscreenChange', handleFullscreenChange);

        function handleFullscreenChange() {
            // Si no hay ningún elemento en pantalla completa, salimos del modo foco.
            if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.mozFullScreenElement && !document.msFullscreenElement) {
                body.classList.remove('focus-mode');
            }
        }
    });
</script>
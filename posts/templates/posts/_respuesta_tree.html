{% load auth_extras %}
<div class="respuesta-item" id="respuesta-{{ respuesta.pk }}">
    <div class="threadline-container">
        <div class="threadline" title="Ocultar/Mostrar comentario"></div>
    </div>
    <div>
        <small>
            <strong>{{ respuesta.autor.username }}</strong> - <span title="{{ respuesta.fecha_creacion }}">{{ respuesta.fecha_creacion|timesince }} ago</span>
        </small>
        <div class="respuesta-contenido">
            <p>{{ respuesta.contenido|linebreaks }}</p>
            {% if respuesta.banner %}
                <div class="respuesta-banner" style="margin-top: 1rem;">
                    <a href="{{ respuesta.banner.url }}" target="_blank">
                        <img src="{{ respuesta.banner.url }}" 
                             alt="Imagen adjunta" 
                             style="max-width: 100%; max-height: 400px; height: auto; border-radius: 8px; cursor: pointer;">
                    </a>
                </div>
            {% endif %}
        </div>
        <div class="respuesta-acciones">
            <a href="#" class="reply-btn" data-id="{{ respuesta.pk }}">Responder</a>
            {% if user == respuesta.autor or user.is_superuser or user|has_group:"Administrativo" %}
                | <a href="{% url 'posts:editar_respuesta' pk=respuesta.pk %}">Editar</a>
                | <a href="{% url 'posts:borrar_respuesta' pk=respuesta.pk %}" style="color:var(--danger-color);">Borrar</a>
            {% endif %}
        </div>

    <!-- Formulario de respuesta (oculto) -->
        <div class="reply-form-container" id="reply-form-{{ respuesta.pk }}" style="display:none;">
            <form method="post" action="{% url 'posts:detalle_tema' pk=respuesta.tema.pk %}" enctype="multipart/form-data" class="ajax-response-form">
                {% csrf_token %}
                <input type="hidden" name="current_page" value="{{ request.GET.page|default:'1' }}">
                <input type="hidden" name="parent" value="{{ respuesta.pk }}">
                {{ respuesta_form.contenido }}
                {{ respuesta_form.banner }}
                <button type="submit">Enviar</button>
            </form>
        </div>
    </div>

    <!-- Contenedor para los hijos que se cargarÃ¡n con AJAX -->
    <div class="hijos-container" id="hijos-container-{{ respuesta.pk }}">
        {% if respuesta.hijos.count > 0 %}
            <a href="{% url 'posts:get_hijos_respuesta' pk_parent=respuesta.pk %}" 
               class="load-hijos-btn" 
               data-parent-id="{{ respuesta.pk }}" 
               data-loaded="false">
                <i class="fas fa-comment-dots"></i> Ver {{ respuesta.hijos.count }} respuesta{{ respuesta.hijos.count|pluralize }}
            </a>
        {% endif %}
    </div>
</div>
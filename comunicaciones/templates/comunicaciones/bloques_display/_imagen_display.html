{% if bloque.contenido_imagen %}
<div class="publication-image-wrapper" style="text-align: {{ bloque.alineacion_imagen|default:'center' }};">
    <img src="{{ bloque.contenido_imagen.url }}" 
         alt="{{ bloque.caption_imagen|default:'Imagen de publicación' }}"
         style="
            /* Regla base: la imagen nunca puede ser más ancha que su contenedor */
            max-width: 100%; 
            
            /* Ancho variable basado en la selección del usuario */
            width: {% if bloque.tamanio_imagen == 'small' %}30%
                   {% elif bloque.tamanio_imagen == 'medium' %}50%
                   {% elif bloque.tamanio_imagen == 'large' %}70%
                   {% else %}100%{% endif %};
            
            height: auto;
            border-radius: 8px;
            margin: 1rem 0;">
            
    {% if bloque.caption_imagen %}
    <p style="font-size: 0.9rem; color: var(--secondary-text-color); font-style: italic; margin-top: 0.5rem; text-align: {{ bloque.alineacion_imagen|default:'center' }};">
        {{ bloque.caption_imagen }}
    </p>
    {% endif %}
</div>
{% endif %}